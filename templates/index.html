<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cultural Radar</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: #f0f0f0;
            background-color: #121212;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            width: 100%;
            padding: 40px 20px;
            box-sizing: border-box;
        }
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            text-align: center;
            margin-bottom: 30px;
            color: #f0f0f0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        #searchForm {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
        }
        input[type="text"] {
            width: 70%;
            padding: 12px;
            font-size: 16px;
            background-color: #2a2a2a;
            border: none;
            border-radius: 25px 0 0 25px;
            color: #f0f0f0;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            background-color: #4a4a4a;
            color: #f0f0f0;
            border: none;
            border-radius: 0 25px 25px 0;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #5a5a5a;
        }
        #loading {
            display: none;
            text-align: center;
        }
        .spinner {
            border: 4px solid #333;
            border-top: 4px solid #f0f0f0;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .result {
            margin-bottom: 40px;
            background-color: #1a1a1a;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        .result:hover {
            transform: translateY(-5px);
        }
        .result img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .no-image {
            background-color: #2a2a2a;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            border-radius: 5px;
            font-style: italic;
            color: #888;
        }
        .result h2 {
            font-family: 'Playfair Display', serif;
            margin-top: 0;
            font-size: 1.8rem;
            color: #f0f0f0;
        }
        .result p {
            margin-bottom: 15px;
        }
        .result a {
            color: #4a90e2;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .result a:hover {
            color: #64a6f3;
        }
        
        .search-tags {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .search-tag {
            background-color: #2a2a2a;
            color: #f0f0f0;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .search-tag:hover {
            background-color: #3a3a3a;
        }
        
        .result .snippet {
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #2a2a2a;
            border-radius: 5px;
        }
        
        .recommender-info {
            font-style: italic;
            font-size: 0.9em;
            margin-bottom: 15px;
            color: #b0b0b0;
        }
        
        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }
        .button {
            padding: 8px 16px;
            background-color: #4a4a4a;
            color: #f0f0f0;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        .button:hover {
            background-color: #5a5a5a;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cultural Radar</h1>
        <form id="searchForm">
            <input type="text" name="keyword" id="searchInput" placeholder="Explore culture..." required>
            <button type="submit">Discover</button>
        </form>
        <div class="search-tags">
            <span class="search-tag" data-tag="theatre">Theatre</span>
            <span class="search-tag" data-tag="youtube">YouTube</span>
            <span class="search-tag" data-tag="tv">TV</span>
            <span class="search-tag" data-tag="art">Art</span>
            <span class="search-tag" data-tag="music">Music</span>
            <span class="search-tag" data-tag="books">Books</span>
        </div>
        <div id="loading">
            <div class="spinner"></div>
            <p id="loading-text">Curating recommendations...</p>
        </div>
        <div id="results"></div>
    </div>

    <script>
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault();
            performSearch();
        });

        document.querySelectorAll('.search-tag').forEach(tag => {
            tag.addEventListener('click', function() {
                document.getElementById('searchInput').value = this.dataset.tag;
                performSearch();
            });
        });

        function performSearch() {
            const formData = new FormData(document.getElementById('searchForm'));
            const loadingDiv = document.getElementById('loading');
            const loadingText = document.getElementById('loading-text');
            const resultsDiv = document.getElementById('results');
            
            loadingDiv.style.display = 'block';
            resultsDiv.innerHTML = '';

            const loadingMessages = [
                "Curating recommendations...",
                "Tuning the cultural radar...",
                "Scanning the artistic horizon...",
                "Decoding the zeitgeist...",
                "Consulting the muses...",
                "Brewing a pot of inspiration...",
                "Channeling the spirit of creativity...",
                "Polishing the looking glass of culture...",
                "Calibrating the taste-o-meter...",
                "Sifting through the sands of time...",
                "Navigating the labyrinth of art...",
                "Unrolling the scrolls of wisdom...",
                "Dusting off the tomes of creativity...",
                "Deciphering the hieroglyphs of pop culture...",
                "Tuning the strings of the cosmic lyre...",
                "Adjusting the lens of cultural perception...",
                "Stirring the cauldron of artistic alchemy...",
                "Focusing the kaleidoscope of imagination...",
                "Winding up the clockwork of inspiration...",
                "Aligning the stars of artistic influence...",
                "Polishing the crystal ball of trends...",
                "Untangling the web of cultural connections...",
                "Decanting the finest vintage of ideas...",
                "Tuning the frequency of the creative wavelength...",
                "Summoning the spirits of artistic genius...",
                "Unlocking the vault of cultural treasures...",
                "Mapping the constellations of creativity...",
                "Calibrating the compass of cultural navigation...",
                "Focusing the microscope on artistic details...",
                "Adjusting the sails on the ship of imagination...",
                "Igniting the spark of creative revelation..."
            ];

            let messageIndex = 0;
            loadingText.textContent = loadingMessages[messageIndex]; // Set initial message immediately

            const messageInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % loadingMessages.length;
                loadingText.textContent = loadingMessages[messageIndex];
            }, 4000); // Change message every 4 seconds

            fetch('/search', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                clearInterval(messageInterval);
                loadingDiv.style.display = 'none';
                displayArticles(data);
            })
            .catch(error => {
                clearInterval(messageInterval);
                loadingDiv.style.display = 'none';
                resultsDiv.innerHTML = '<p>An error occurred while searching. Please try again.</p>';
                console.error('Error:', error);
            });
        }

        function displayArticles(data) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            data.forEach(result => {
                const resultDiv = document.createElement('div');
                resultDiv.classList.add('result');
                const proxyImageUrl = result.image ? `/proxy_image?url=${encodeURIComponent(result.image)}` : null;
                resultDiv.innerHTML = `
                    ${proxyImageUrl 
                        ? `<img src="${proxyImageUrl}" alt="${result.title}" onerror="this.onerror=null; this.src='/static/placeholder.jpg';">`
                        : '<img src="/static/placeholder.jpg" alt="Placeholder image">'}
                    <h2>${result.title}</h2>
                    <p><strong>Recommended by:</strong> ${result.recommended_by}</p>
                    <p class="recommender-info">${result.recommender_info}</p>
                    <div class="snippet">${result.snippet}</div>
                    <div class="button-container">
                        <a href="${result.link}" target="_blank" class="button">Read Guardian Article</a>
                        ${result.recommendation_link 
                            ? `<a href="${result.recommendation_link}" target="_blank" class="button">View Recommendation</a>`
                            : ''}
                    </div>
                `;
                resultsDiv.appendChild(resultDiv);
            });
        }
    </script>
</body>
</html>
